<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ITP | Item Trading Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .main-content { background-color: #fff; min-height: 100vh; }
        body { margin: 0; overflow-x: hidden; }
        .img-fluid { width: 50%; height: auto;}
        /* ‚ù§Ô∏è style tim y√™u th√≠ch */
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc3545;
            font-size: 1.2rem;
            transition: all 0.2s ease-in-out;
            z-index: 10;
        }
        .favorite-btn:hover {
            background: #fee2e2;
            transform: scale(1.1);
        }

        .featured-product-card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .featured-product-card .card-img-top {
            width: 100%;
            height: 200px;
            object-fit: cover;
            object-position: center;
        }
        .featured-product-card .card-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .featured-product-card .card-body .btn {
            margin-top: auto;
        }
    </style>
</head>

<body>

<!-- Header -->
<div th:replace="~{/Included/Header :: header}"></div>

<div class="container-fluid">
    <div class="row g-0">
        <!-- KH√îNG d√πng sidebar -->

        <!-- N·ªôi dung ch√≠nh -->
        <div class="col-12 main-content p-0">

            <!-- Flash Messages -->
            <div class="container mt-3">
                <!-- Success Message -->
                <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <span th:text="${success}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Error Message -->
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Info Message -->
                <div th:if="${info}" class="alert alert-info alert-dismissible fade show" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <span th:text="${info}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </div>

            <!-- Hero Section -->
            <section class="py-5 bg-light text-center">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-6 text-start">
                            <h1 class="fw-bold mb-3">ITP</h1>
                            <p class="lead mb-4">
                                Chuy√™n cung c·∫•p c√°c d·ªãch v·ª• v√† s·∫£n ph·∫©m MMO ch·∫•t l∆∞·ª£ng cao v·ªõi gi√° c·∫£ ph·∫£i chƒÉng.
                                Uy t√≠n ‚Äì Ch·∫•t l∆∞·ª£ng ‚Äì B·∫£o h√†nh.
                            </p>
                            <a th:href="@{/products}" class="btn btn-dark btn-lg">Kh√°m ph√° ngay</a>

                            <!-- N√∫t Shop Dashboard cho SELLER (Main branch logic) -->
                            <a th:href="@{/shop/dashboard}"
                               th:if="${session.user != null and session.role == 'SELLER'}"
                               class="btn btn-outline-primary btn-lg ms-2">
                                <i class="fas fa-store me-2"></i>Shop Dashboard
                            </a>

                            <!-- N√∫t ƒêƒÉng k√Ω Shop cho CUSTOMER (Main branch logic) -->
                            <a th:href="@{/shop/register}"
                               th:if="${session.user != null and session.role == 'CUSTOMER'}"
                               class="btn btn-success btn-lg ms-2">
                                <i class="fas fa-shop me-2"></i>ƒêƒÉng k√Ω Shop
                            </a>
                        </div>
                        <div class="col-md-6 text-center">
                            <img th:src="@{/img/hero-setup.jpg}" alt="MMO setup" class="img-fluid rounded shadow">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Product Categories -->
            <section class="py-5">
                <div class="container text-center">
                    <h2 class="fw-bold mb-4">Danh m·ª•c s·∫£n ph·∫©m</h2>
                    <div class="row justify-content-center g-4">

                        <!-- Th·∫ª ƒëi·ªán tho·∫°i (TELECOM) -->
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm p-3">
                                <div class="fs-1 text-secondary mb-2">üì∂</div>
                                <h5>Th·∫ª ƒëi·ªán tho·∫°i</h5>
                                <p class="text-muted small">N·∫°p ti·ªÅn, data, d·ªãch v·ª• vi·ªÖn th√¥ng</p>
                            </div>
                        </div>

                        <!-- T√†i kho·∫£n s·ªë (DIGITAL_ACCOUNTS) -->
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm p-3">
                                <div class="fs-1 text-secondary mb-2">üîê</div>
                                <h5>T√†i kho·∫£n s·ªë</h5>
                                <p class="text-muted small">C√°c lo·∫°i t√†i kho·∫£n/d·ªãch v·ª• s·ªë</p>
                            </div>
                        </div>

                        <!-- Ph·∫ßn m·ªÅm (SOFTWARE_LICENSES) -->
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm p-3">
                                <div class="fs-1 text-secondary mb-2">üßæ</div>
                                <h5>Ph·∫ßn m·ªÅm</h5>
                                <p class="text-muted small">License & ·ª©ng d·ª•ng b·∫£n quy·ªÅn</p>
                            </div>
                        </div>

                        <!-- Kh√°c (OTHER) -->
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm p-3">
                                <div class="fs-1 text-secondary mb-2">üóÇÔ∏è</div>
                                <h5>Kh√°c</h5>
                                <p class="text-muted small">Danh m·ª•c kh√°c</p>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- Seller Section -->
            <section class="py-5" th:if="${session.user != null and session.role == 'SELLER'}">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h4 class="mb-0">üè™ Shop Management</h4>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Shop Dashboard! Qu·∫£n l√Ω s·∫£n ph·∫©m, ƒë∆°n h√†ng v√† doanh thu c·ªßa shop.</p>
                                    <div class="d-flex gap-2">
                                        <a th:href="@{/shop/dashboard}" class="btn btn-primary">Shop Dashboard</a>
                                        <a th:href="@{/shop/addProduct}" class="btn btn-outline-primary">Th√™m s·∫£n ph·∫©m</a>
                                        <a th:href="@{/shop/inventory}" class="btn btn-outline-primary">Kho h√†ng</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Featured Products -->
            <section class="py-5 bg-light">
                <div class="container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="fw-bold mb-0">S·∫£n ph·∫©m n·ªïi b·∫≠t</h2>
                        <a th:href="@{/products}" class="btn btn-link text-decoration-none">Xem t·∫•t c·∫£ ‚Üí</a>
                    </div>

                    <!-- C√≥ d·ªØ li·ªáu -->
                    <div class="row g-4" th:if="${featuredProducts != null and !featuredProducts.isEmpty()}">
                        <div class="col-6 col-md-3" th:each="p : ${featuredProducts}">
                            <div class="card h-100 shadow-sm position-relative">

                                <!-- ‚ù§Ô∏è Y√™u th√≠ch -->
                                <div th:if="${user != null}">
                                    <!-- N·∫øu ƒë√£ y√™u th√≠ch -->
                                    <form th:if="${favoriteProductIds != null and favoriteProductIds.contains(p.id)}"
                                          th:action="@{'/favorites/remove/' + ${p.id}}" method="post">
                                        <input type="hidden" name="redirect" th:value="${requestURI}" />
                                        <button type="submit" class="favorite-btn" title="X√≥a kh·ªèi y√™u th√≠ch">
                                            <i class="fa-solid fa-heart-crack"></i>
                                        </button>
                                    </form>

                                    <!-- N·∫øu ch∆∞a y√™u th√≠ch -->
                                    <form th:if="${favoriteProductIds == null or !favoriteProductIds.contains(p.id)}"
                                          th:action="@{'/favorites/add/' + ${p.id}}" method="post">
                                        <input type="hidden" name="redirect" th:value="${requestURI}" />
                                        <button type="submit" class="favorite-btn" title="Th√™m v√†o y√™u th√≠ch">
                                            <i class="fa-regular fa-heart"></i>
                                        </button>
                                    </form>
                                </div>

                                <a th:href="@{/product/{id}(id=${p.id})}" style="display: block; position: relative; overflow: hidden;">
                                    <img th:src="${p.image != null and !#strings.isEmpty(p.image)} ? 
                                                ('/itp' + ${p.image}) : 
                                                'https://picsum.photos/seed/placeholder/400/300'"
                                         class="card-img-top" 
                                         style="height: 200px; object-fit: cover;"
                                         th:alt="${p.productName}"
                                         onerror="this.src='https://picsum.photos/seed/placeholder/400/300';" />
                                </a>
                                <div class="card-body">
                                    <h6 th:text="${p.productName}" class="card-title mb-2">T√™n s·∫£n ph·∫©m</h6>
                                    <p class="card-text fw-bold text-primary mb-3"
                                       th:text="${#numbers.formatDecimal(p.price,0,'COMMA',0,'POINT')} + ' ‚Ç´'">
                                        150.000 ‚Ç´
                                    </p>
                                    <a th:href="@{/product/{id}(id=${p.id})}" class="btn btn-outline-dark w-100">
                                        Xem chi ti·∫øt
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- R·ªóng -->
                    <div class="text-center py-5 text-muted"
                         th:if="${featuredProducts == null or featuredProducts.isEmpty()}">
                        Ch∆∞a c√≥ s·∫£n ph·∫©m n·ªïi b·∫≠t.
                    </div>
                </div>
            </section>

        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{/Included/Footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
