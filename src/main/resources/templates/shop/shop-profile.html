<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{Included/ShopHeader :: shopHead}">
    <title>Hồ sơ Shop</title>
</head>

<body style="background-color: #f8f9fa;">
<!-- Header -->
<div th:replace="~{Included/ShopHeader :: shopHeader}"></div>

<div class="container-fluid p-0">
    <div class="row g-0">
        <!-- Sidebar - Fixed Left -->
        <aside class="col-auto" style="width: 70px; position: fixed; left: 0; top: 56px; bottom: 0; z-index: 100; overflow-y: auto;">
            <div th:replace="~{Included/ShopSidebar :: sidebar}"></div>
        </aside>

        <!-- Main Content -->
        <main class="col" style="margin-left: 70px; padding: 20px;">
            
            <!-- Alert Container for AJAX responses -->
            <div id="alertContainer"></div>

            <!-- Page Header với nút Sửa/Lưu -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0">
                    <i class="fas fa-store text-primary me-2"></i>
                    Hồ sơ Shop
                </h2>
                <div>
                    <button type="button" id="editBtn" class="btn btn-warning" onclick="enableEdit()">
                        <i class="fas fa-edit me-2"></i>Sửa thông tin
                    </button>
                    <button type="button" id="saveBtn" class="btn btn-success d-none" onclick="saveProfile()">
                        <i class="fas fa-save me-2"></i>Lưu thay đổi
                    </button>
                    <button type="button" id="cancelBtn" class="btn btn-secondary d-none" onclick="cancelEdit()">
                        <i class="fas fa-times me-2"></i>Hủy
                    </button>
                </div>
            </div>

            <!-- STATISTICS CARDS -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #3b82f6 !important;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted small mb-1">Tổng sản phẩm</div>
                                    <h3 class="fw-bold mb-0" th:text="${totalProducts != null ? totalProducts : 0}">0</h3>
                                </div>
                                <div class="bg-primary bg-opacity-10 p-3 rounded">
                                    <i class="fas fa-box fa-2x text-primary"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #10b981 !important;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted small mb-1">SP đang bán</div>
                                    <h3 class="fw-bold mb-0" th:text="${activeProducts != null ? activeProducts : 0}">0</h3>
                                </div>
                                <div class="bg-success bg-opacity-10 p-3 rounded">
                                    <i class="fas fa-check-circle fa-2x text-success"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #f59e0b !important;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted small mb-1">Tổng kho</div>
                                    <h3 class="fw-bold mb-0" th:text="${totalStock != null ? totalStock : 0}">0</h3>
                                </div>
                                <div class="bg-warning bg-opacity-10 p-3 rounded">
                                    <i class="fas fa-cubes fa-2x text-warning"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-3">
                    <div class="card border-0 shadow-sm h-100" style="border-left: 4px solid #8b5cf6 !important;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted small mb-1">Đánh giá</div>
                                    <h3 class="fw-bold mb-0">
                                        <i class="fas fa-star text-warning"></i>
                                        <span th:text="${shop.rating != null ? shop.rating : '0.0'}">0.0</span>
                                    </h3>
                                </div>
                                <div class="bg-purple bg-opacity-10 p-3 rounded" style="background: rgba(139, 92, 246, 0.1) !important;">
                                    <i class="fas fa-star fa-2x" style="color: #8b5cf6;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FORM -->
            <form id="shopProfileForm" th:action="@{/shop/profile/update}" method="post" enctype="multipart/form-data">
                
                <div class="row">
                    <!-- LEFT COLUMN -->
                    <div class="col-lg-8">
                        
                        <!-- Basic Information -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header bg-white border-bottom">
                                <h5 class="mb-0 fw-bold">
                                    <i class="fas fa-info-circle text-primary me-2"></i>
                                    Thông tin cơ bản
                                </h5>
                            </div>
                            <div class="card-body p-4">
                                <div class="row">
                                    <!-- Shop Name -->
                                    <div class="col-md-6 mb-3">
                                        <label for="shopName" class="form-label fw-semibold">
                                            Tên Shop <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control edit-field" id="shopName" 
                                               name="shopName" th:value="${shop.shopName}" 
                                               placeholder="VD: TechStore Vietnam" 
                                               required maxlength="100" readonly>
                                        <small class="form-text text-muted">Tên hiển thị cho khách hàng</small>
                                    </div>

                                    <!-- Categories (Multi-select) -->
                                    <div class="col-12 mb-3">
                                        <label class="form-label fw-semibold">
                                            Danh mục Shop <span class="text-danger">*</span>
                                        </label>
                                        <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto; background: #f8f9fa;" id="categoryCheckboxes">
                                            <div th:each="cat : ${allCategories}" class="form-check mb-2">
                                                <input class="form-check-input category-checkbox edit-field" 
                                                       type="checkbox" 
                                                       th:id="${'cat_' + cat.id}"
                                                       th:value="${cat.categoryName}"
                                                       th:checked="${#strings.contains(shop.category, cat.categoryName)}"
                                                       disabled>
                                                <label class="form-check-label" th:for="${'cat_' + cat.id}" th:text="${cat.categoryName}">
                                                    Category Name
                                                </label>
                                            </div>
                                        </div>
                                        <input type="hidden" id="selectedCategories" name="category" th:value="${shop.category}" required>
                                        <small class="form-text text-muted">Chọn danh mục sản phẩm</small>
                                    </div>

                                    <!-- Email -->
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label fw-semibold">
                                            Email liên hệ <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            <input type="email" class="form-control edit-field" id="email" name="email" 
                                                   th:value="${shop.email}" 
                                                   placeholder="shop@example.com" required readonly>
                                        </div>
                                        <small class="form-text text-muted">Email hỗ trợ khách hàng</small>
                                    </div>

                                    <!-- Phone -->
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label fw-semibold">
                                            Số điện thoại <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            <input type="tel" class="form-control edit-field" id="phone" name="phone" 
                                                   th:value="${shop.phone}" 
                                                   placeholder="0912345678" 
                                                   required pattern="0[0-9]{9}" 
                                                   title="Số điện thoại VN (10 số, bắt đầu bằng 0)" readonly>
                                        </div>
                                        <small class="form-text text-muted">10 chữ số, bắt đầu bằng 0</small>
                                    </div>

                                    <!-- Facebook Link -->
                                    <div class="col-12 mb-3">
                                        <label for="facebookLink" class="form-label fw-semibold">
                                            <i class="fab fa-facebook text-primary me-2"></i>Link Facebook
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fab fa-facebook"></i></span>
                                            <input type="url" class="form-control edit-field" id="facebookLink" name="facebookLink" 
                                                   th:value="${shop.facebookLink}" 
                                                   placeholder="https://facebook.com/yourshop" 
                                                   maxlength="500" readonly>
                                        </div>
                                        <small class="form-text text-muted">Link trang Facebook của shop (không bắt buộc)</small>
                                    </div>

                                    <!-- Short Description -->
                                    <div class="col-12 mb-3">
                                        <label for="shortDescription" class="form-label fw-semibold">
                                            Mô tả ngắn
                                            <span class="badge bg-secondary ms-2">Hiển thị trên thẻ shop</span>
                                        </label>
                                        <textarea class="form-control edit-field" id="shortDescription" name="shortDescription" 
                                                  rows="2" th:text="${shop.shortDescription}"
                                                  maxlength="500"
                                                  placeholder="VD: Chuyên cung cấp tài khoản game, thẻ nạp, voucher uy tín - Giao hàng tự động 24/7"
                                                  oninput="updateCharCount()" readonly></textarea>
                                        <div class="d-flex justify-content-between mt-1">
                                            <small class="form-text text-muted">Giới thiệu ngắn gọn (1-2 câu)</small>
                                            <small class="text-muted">
                                                <span id="shortDescCount">0</span>/500
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Detailed Description -->
                                    <div class="col-12">
                                        <label for="description" class="form-label fw-semibold">
                                            Mô tả chi tiết
                                        </label>
                                        <textarea class="form-control edit-field" id="description" name="description" 
                                                  rows="8" th:text="${shop.description}"
                                                  placeholder="Mô tả chi tiết về shop và các mặt hàng kinh doanh..." readonly></textarea>
                                        <small class="form-text text-muted">
                                            <i class="fas fa-lightbulb me-1"></i>
                                            Mô tả đầy đủ về shop, sản phẩm, dịch vụ
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions (Only when editing) -->
                        <div class="card shadow-sm border-0 mb-4 border-start border-danger border-4 d-none" id="termsCard">
                            <div class="card-body p-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="agreeToTerms" name="agreeToTerms" required disabled>
                                    <label class="form-check-label fw-semibold" for="agreeToTerms">
                                        <i class="fas fa-file-contract text-danger me-2"></i>
                                        Tôi đồng ý với 
                                        <a href="#" class="text-primary">Điều khoản dịch vụ</a> và 
                                        <a href="#" class="text-primary">Chính sách</a>
                                        <span class="text-danger">*</span>
                                    </label>
                                </div>
                                <small class="text-muted d-block mt-2">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Bạn phải đồng ý với điều khoản để cập nhật thông tin shop
                                </small>
                            </div>
                        </div>

                        <!-- Status Info (Read-only) -->
                        <div class="card shadow-sm border-0 mb-4 border-start border-warning border-4">
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-lock fa-2x text-warning me-3"></i>
                                    <div>
                                        <h6 class="fw-bold mb-1">Trạng thái Shop</h6>
                                        <span class="badge" 
                                              th:classappend="${shop.status == 'ACTIVE' ? 'bg-success' : 'bg-secondary'}"
                                              th:text="${shop.status == 'ACTIVE' ? 'Đang hoạt động' : shop.status}">
                                            Đang hoạt động
                                        </span>
                                        <small class="text-muted d-block mt-1">
                                            Trạng thái shop được quản lý bởi Admin
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- RIGHT COLUMN -->
                    <div class="col-lg-4">
                        
                        <!-- Shop Logo -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header bg-white border-bottom">
                                <h5 class="mb-0 fw-bold">
                                    <i class="fas fa-image text-primary me-2"></i>
                                    Logo Shop
                                </h5>
                            </div>
                            <div class="card-body p-4 text-center">
                                <div class="mb-3 d-flex justify-content-center">
                                    <div style="width: 200px; height: 200px; border-radius: 50%; overflow: hidden; border: 3px solid #dee2e6; box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);">
                                        <img id="logoPreview" 
                                             th:src="${shop.imageUrl != null && shop.imageUrl != '' ? '/itp' + shop.imageUrl : ''}" 
                                             alt="Shop Logo" 
                                             style="width: 100%; height: 100%; object-fit: cover; display: block;"
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div id="logoPlaceholder" th:style="${shop.imageUrl != null && shop.imageUrl != '' ? 'display:none;' : 'display:flex;'}" style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold;">
                                            LOGO
                                        </div>
                                    </div>
                                </div>
                                <label for="logoInput" class="btn btn-outline-primary w-100 edit-upload disabled" style="pointer-events: none; opacity: 0.6;">
                                    <i class="fas fa-upload me-2"></i>Tải lên Logo
                                </label>
                                <input type="file" id="logoInput" name="logoImage" accept="image/*" 
                                       style="display: none;" onchange="previewLogo(event)" disabled>
                                <small class="form-text text-muted d-block mt-2">
                                    JPG, PNG (Tối đa 5MB)
                                </small>
                            </div>
                        </div>

                        <!-- Shop Banner -->
                        <div class="card shadow-sm border-0 mb-4">
                            <div class="card-header bg-white border-bottom">
                                <h5 class="mb-0 fw-bold">
                                    <i class="fas fa-image text-primary me-2"></i>
                                    Ảnh bìa Shop
                                </h5>
                            </div>
                            <div class="card-body p-4 text-center">
                                <div class="mb-3 position-relative" style="width: 100%; height: 200px; border-radius: 0.375rem; overflow: hidden; border: 1px solid #dee2e6;">
                                    <img id="bannerPreview" 
                                         th:src="${shop.image != null && shop.image != '' ? '/itp' + shop.image : ''}" 
                                         alt="Shop Banner" 
                                         style="width: 100%; height: 100%; object-fit: cover; display: block;"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div id="bannerPlaceholder" th:style="${shop.image != null && shop.image != '' ? 'display:none;' : 'display:flex;'}" style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); align-items: center; justify-content: center; color: white; font-size: 28px; font-weight: bold; position: absolute; top: 0; left: 0;">
                                        Shop Banner
                                    </div>
                                </div>
                                <label for="bannerInput" class="btn btn-outline-primary w-100 edit-upload disabled" style="pointer-events: none; opacity: 0.6;">
                                    <i class="fas fa-upload me-2"></i>Tải lên Banner
                                </label>
                                <input type="file" id="bannerInput" name="shopImage" accept="image/*" 
                                       style="display: none;" onchange="previewBanner(event)" disabled>
                                <small class="form-text text-muted d-block mt-2">
                                    1200x300px, JPG/PNG (Max 5MB)
                                </small>
                            </div>
                        </div>

                    </div>
                </div>

            </form>

        </main>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{Included/ShopFooter :: shopFooter}"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Shop Profile JS -->
<script th:src="@{/assets/ajax/shop/shop-profile.js}"></script>
</body>
</html>
