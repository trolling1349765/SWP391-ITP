<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{Included/ShopHeader :: shopHead}">
    <link rel="stylesheet" th:href="@{/assets/css/shop/addProduct.css}">
</head>
<body style="margin:0;padding-top:56px;overflow-x:hidden;">
<div th:replace="~{Included/ShopHeader :: shopHeader}"></div>

<div class="container-fluid p-0">
    <div class="row g-0">
        <div class="col-md-3 col-lg-2 p-0" style="position:fixed;top:56px;bottom:0;left:0;z-index:1000;">
            <aside th:replace="~{Included/ShopSidebar :: sidebar}"></aside>
        </div>

        <div class="col-md-9 col-lg-10 p-3 ms-auto">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h4 class="mb-0">Th√™m s·∫£n ph·∫©m</h4>
                <a th:href="@{/shop/dashboard}" class="btn btn-outline-secondary btn-sm">‚Üê Dashboard</a>
            </div>

            <form th:action="@{/shop/addProduct}" th:object="${form}" method="post" enctype="multipart/form-data"
                  class="row g-3">

                <div class="col-md-8">
                    <label class="form-label">T√™n s·∫£n ph·∫©m</label>
                    <input th:field="*{productName}" class="form-control" placeholder="Nh·∫≠p t√™n..." required/>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Gi√° <span class="text-danger">*</span></label>
                    <input th:field="*{price}" id="priceInput" type="number" min="0" step="0.01" class="form-control"
                           placeholder="0.00" required/>
                    <small class="text-muted">Gi√° n√†y s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông ƒëi·ªÅn khi ch·ªçn m·ªánh gi√°</small>
                </div>

                <div class="col-md-6" th:if="${categories != null}">
                    <label class="form-label">Ph√¢n lo·∫°i s·∫£n ph·∫©m</label>
                    <select th:field="*{categoryId}" class="form-select">
                        <option value="">-- Ch·ªçn ph√¢n lo·∫°i (t√πy ch·ªçn) --</option>
                        <option th:each="c : ${categories}" th:value="${c.id}"
                                th:text="${@shopController.getCategoryDisplayName(c.categoryName)}">Cat
                        </option>
                    </select>
                </div>
                <input th:if="${categories == null}" type="hidden" th:field="*{categoryId}"/>

                <div class="col-md-6">
                    <label class="form-label">Ki·ªÉu s·∫£n ph·∫©m <span class="text-danger">*</span></label>
                    <select th:field="*{productType}" id="productTypeSelect" class="form-select" required
                            onchange="updateProductTypeGuide()">
                        <option value="">-- Ch·ªçn ki·ªÉu s·∫£n ph·∫©m --</option>
                        <!-- Options will be populated dynamically based on category selection -->
                    </select>
                </div>

                <div class="col-md-6" id="faceValueSection" style="display: none;">
                    <label class="form-label">M·ªánh gi√° <span class="text-danger">*</span></label>
                    <select id="faceValueSelect" name="faceValue" class="form-select"
                            onchange="updatePriceFromFaceValue()">
                        <option value="">-- Ch·ªçn m·ªánh gi√° --</option>
                        <option value="10000">10,000 ‚Ç´</option>
                        <option value="20000">20,000 ‚Ç´</option>
                        <option value="50000">50,000 ‚Ç´</option>
                        <option value="100000">100,000 ‚Ç´</option>
                        <option value="200000">200,000 ‚Ç´</option>
                        <option value="500000">500,000 ‚Ç´</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                </div>

                <!-- Business Fields -->
                <div class="col-md-6">
                    <label class="form-label">Nh√† cung c·∫•p</label>
                    <input name="supplier" type="text" class="form-control" placeholder="T√™n nh√† cung c·∫•p"/>
                    <small class="text-muted">T√™n c√¥ng ty/nh√† cung c·∫•p s·∫£n ph·∫©m</small>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Ph√≠ s√†n (%)</label>
                    <input name="platformFee" type="number" min="0" max="50" step="0.1" class="form-control"
                           placeholder="0" value="0" id="platformFeeInput" readonly/>
                    <small class="text-muted">Ph√≠ s√†n t·ª± ƒë·ªông theo lo·∫°i s·∫£n ph·∫©m</small>
                    <div id="platformFeeInfo" class="mt-1"></div>
                </div>

                <div class="col-md-12">
                    <label class="form-label">M√¥ t·∫£ ng·∫Øn</label>
                    <textarea th:field="*{description}" class="form-control" rows="2"
                              placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ s·∫£n ph·∫©m"></textarea>
                </div>

                <div class="col-md-12">
                    <label class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
                    <textarea th:field="*{detailedDescription}" class="form-control" rows="4"
                              placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ s·∫£n ph·∫©m, t√≠nh nƒÉng, c√°ch s·ª≠ d·ª•ng..."></textarea>
                </div>

                <div class="col-md-12">
                    <label class="form-label">·∫¢nh (t√πy ch·ªçn)</label>
                    <input th:field="*{file}" type="file" class="form-control" accept="image/*"/>
                    <small class="text-muted">Ch·ªçn file ·∫£nh ƒë·ªÉ upload</small>
                </div>

                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">Th√¥ng tin Serial</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">B·∫Øt bu·ªôc upload file Excel ƒë·ªÉ nh·∫≠p serial</p>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label mb-0">File Excel ch·ª©a Serial</label>
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/shop/addProductTemplate}" class="btn btn-outline-primary btn-sm">
                                            üì• T·∫£i Template
                                        </a>
                                        <button type="button" class="btn btn-outline-danger btn-sm"
                                                onclick="clearFileInput()">
                                            üóëÔ∏è X√≥a File
                                        </button>
                                    </div>
                                </div>
                                <input th:field="*{serialFile}" type="file" class="form-control" accept=".xlsx,.xls"
                                       required id="serialFileInput" onchange="previewExcelFile(this)"/>
                                <small class="text-muted">Upload file Excel theo template chu·∫©n</small>
                                <div id="fileInfo" class="mt-2"></div>

                                <!-- Excel Preview Table -->
                                <div id="excelPreview" class="mt-3" style="display: none;">
                                    <div class="card border-warning">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0">Danh s√°ch serials s·∫Ω ƒë∆∞·ª£c th√™m v√†o</h6>
                                        </div>
                                        <div class="card-body p-0">
                                            <div class="table-responsive">
                                                <table class="table table-striped table-hover mb-0">
                                                    <thead class="table-dark">
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Serial Code</th>
                                                        <th>Secret Code</th>
                                                        <th>Face Value</th>
                                                        <th>Information</th>
                                                        <th>Tr·∫°ng th√°i</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="excelPreviewBody">
                                                    <!-- Dynamic content will be inserted here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="card-footer bg-light">
                                                <small class="text-muted">
                                                    <i class="fas fa-info-circle"></i>
                                                    T·ªïng c·ªông: <span id="totalSerials">0</span> serials s·∫Ω ƒë∆∞·ª£c th√™m v√†o
                                                    s·∫£n ph·∫©m n√†y
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- Import Results Display -->
                            <div id="importResults" class="mb-3" style="display: none;">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">üìä K·∫øt qu·∫£ Import</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="importSummary" class="row g-2 mb-3"></div>
                                        <div id="importDetails" class="row g-2 mb-3"></div>

                                        <!-- Serial List Table -->
                                        <div id="serialListSection" class="mt-3" style="display: none;">
                                            <div class="card border-info">
                                                <div class="card-header bg-info text-white">
                                                    <h6 class="mb-0">üìã Danh S√°ch Serials ƒê√£ Import</h6>
                                                </div>
                                                <div class="card-body p-0">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover mb-0">
                                                            <thead class="table-dark">
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Serial Code</th>
                                                                <th>Secret Code</th>
                                                                <th>Face Value</th>
                                                                <th>Information</th>
                                                                <th>Status</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody id="serialListBody">
                                                            <!-- Dynamic content will be inserted here -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Validation Check Table -->
                                        <div id="validationTableSection" class="mt-3" style="display: none;">
                                            <div class="card border-warning">
                                                <div class="card-header bg-warning text-dark">
                                                    <h6 class="mb-0">üîç B·∫£ng Ki·ªÉm Tra Validation</h6>
                                                </div>
                                                <div class="card-body p-0">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover mb-0">
                                                            <thead class="table-warning">
                                                            <tr>
                                                                <th>D√≤ng</th>
                                                                <th>Serial Code</th>
                                                                <th>Validation</th>
                                                                <th>L·ªói</th>
                                                                <th>C·∫£nh B√°o</th>
                                                                <th>Tr·∫°ng Th√°i</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody id="validationTableBody">
                                                            <!-- Dynamic content will be inserted here -->
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info">
                                <h6>H∆∞·ªõng d·∫´n t·∫°o file Excel:</h6>
                                <div class="phone-card-guide" style="display: none;">
                                    <strong>Th·∫ª ƒëi·ªán tho·∫°i:</strong>
                                    <ul class="mb-0">
                                        <li><strong>Serial Code:</strong> M√£ th·∫ª ƒëi·ªán tho·∫°i (VD: 1234567890123456)</li>
                                        <li><strong>Secret Code:</strong> M√£ PIN th·∫ª (VD: ABCD1234)</li>
                                        <li><strong>Face Value:</strong> M·ªánh gi√° th·∫ª (VD: 10000)</li>
                                        <li><strong>Information:</strong> Th√¥ng tin b·ªï sung (VD: Th·∫ª Viettel 10K)</li>
                                    </ul>
                                </div>

                                <div class="email-account-guide" style="display: none;">
                                    <strong>T√†i kho·∫£n email:</strong>
                                    <ul class="mb-0">
                                        <li><strong>Serial Code:</strong> Email address (VD: user123@gmail.com)</li>
                                        <li><strong>Secret Code:</strong> Password (VD: password123)</li>
                                        <li><strong>Face Value:</strong> Gi√° b√°n t√†i kho·∫£n (c√≥ th·ªÉ t√πy ch·ªânh)</li>
                                        <li><strong>Information:</strong> Th√¥ng tin b·ªï sung (ƒë√£ verify, ch∆∞a verify,
                                            etc.)
                                        </li>
                                    </ul>
                                </div>
                                <div class="gift-card-guide" style="display: none;">
                                    <strong>Th·∫ª qu√† t·∫∑ng:</strong>
                                    <ul class="mb-0">
                                        <li><strong>Serial Code:</strong> M√£ th·∫ª qu√† t·∫∑ng</li>
                                        <li><strong>Secret Code:</strong> Pin code (n·∫øu c√≥)</li>
                                        <li><strong>Face Value:</strong> M·ªánh gi√° th·∫ª</li>
                                        <li><strong>Information:</strong> Lo·∫°i th·∫ª, h·∫°n s·ª≠ d·ª•ng</li>
                                    </ul>
                                </div>
                                <div class="software-key-guide" style="display: none;">
                                    <strong>Key ph·∫ßn m·ªÅm:</strong>
                                    <ul class="mb-0">
                                        <li><strong>Serial Code:</strong> License key (VD: XXXXX-XXXXX-XXXXX)</li>
                                        <li><strong>Secret Code:</strong> Activation code (n·∫øu c√≥)</li>
                                        <li><strong>Face Value:</strong> Gi√° b√°n key</li>
                                        <li><strong>Information:</strong> T√™n ph·∫ßn m·ªÅm, phi√™n b·∫£n</li>
                                    </ul>
                                </div>
                                <div class="default-guide">
                                    <ol class="mb-0">
                                        <li>Ch·ªçn ki·ªÉu s·∫£n ph·∫©m ƒë·ªÉ xem h∆∞·ªõng d·∫´n chi ti·∫øt</li>
                                        <li>Download template Excel chu·∫©n</li>
                                        <li>Upload file Excel ƒë·ªÉ h·ªá th·ªëng t·ª± ƒë·ªông ƒë·∫øm s·ªë l∆∞·ª£ng</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary" onclick="return confirmSubmit()">T·∫°o s·∫£n ph·∫©m
                        </button>
                        <a th:href="@{/shop/dashboard}" class="btn btn-secondary">H·ªßy</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script th:src="@{/assets/js/shop/addProduct.js}"></script>
</body>
</html>