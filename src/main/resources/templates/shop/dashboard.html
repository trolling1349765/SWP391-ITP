<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{Included/ShopHeader :: shopHead}"></head>
<body>
<div th:replace="~{Included/ShopHeader :: shopHeader}"></div>

<div class="row g-3">
    <!-- Sidebar -->
    <div class="col-12 col-lg-3 col-xl-2">
        <aside th:replace="~{Included/ShopSidebar :: sidebar}"></aside>
    </div>

    <!-- Main -->
    <div class="col-12 col-lg-9 col-xl-10">
        <div th:if="${ok}" class="alert alert-success" th:text="${ok}"></div>
        <div th:if="${err}" class="alert alert-danger" th:text="${err}"></div>

        <div class="d-flex gap-2 mb-3">
            <a th:href="@{/shop/addProduct}" class="btn btn-primary">Thêm Sản Phẩm</a>
            <a th:href="@{/shop/inventory}" class="btn btn-secondary">Quản Lý Kho</a>
        </div>

        <div class="card">
            <div class="card-header">Danh sách sản phẩm</div>
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th><th>Ảnh</th><th>Tên</th><th>Mô tả</th>
                        <th>Giá</th><th>Tồn</th><th>Trạng thái</th><th class="text-nowrap">Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="p : ${products}">
                        <td th:text="${p.id}">1</td>
                        <td><img th:if="${p.image}" th:src="${p.image}" class="img-thumbnail" style="max-height:56px"/></td>
                        <td th:text="${p.productName}">Tên</td>
                        <td th:text="${p.description}">Mô tả</td>
                        <td th:text="${#numbers.formatCurrency(p.price)}">0</td>
                        <td th:text="${stockMap[p.id]}">0</td>
                        <td><span class="badge text-bg-dark" th:text="${p.status}">HIDDEN</span></td>
                        <td class="text-nowrap">
                            <a th:href="@{|/shop/updateProduct/${p.id}|}" class="btn btn-sm btn-outline-primary">Sửa</a>
                            <a th:href="@{|/shop/products/${p.id}/serials|}" class="btn btn-sm btn-outline-secondary">Serials</a>

                            <!-- Đổi trạng thái: ACTIVE/HIDDEN/BLOCKED -->
                            <form th:action="@{|/shop/products/${p.id}/status|}" method="post" class="d-inline-flex align-items-center ms-1">
                                <select class="form-select form-select-sm" name="status">
                                    <option value="ACTIVE"  th:selected="${p.status.name()=='ACTIVE'}">ACTIVE</option>
                                    <option value="HIDDEN"  th:selected="${p.status.name()=='HIDDEN'}">HIDDEN</option>
                                    <option value="BLOCKED" th:selected="${p.status.name()=='BLOCKED'}">BLOCKED</option>
                                </select>
                                <button type="submit" class="btn btn-sm btn-dark ms-2">Đổi</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div th:replace="~{Included/ShopFooter :: shopFooter}"></div>
</body>
</html>
