<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Shop Dashboard</title>
    <style>
        :root{--bg:#0b1220;--panel:#0f172a;--line:#1f2937;--txt:#e5e7eb;--muted:#9ca3af;--accent:#22c55e;--btn:#2563eb}
        body{margin:0;background:var(--bg);color:var(--txt);font:14px/1.5 ui-sans-serif,system-ui}
        .wrap{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
        .sidebar{background:#0f172a;border-right:1px solid var(--line);padding:12px}
        .nav a{display:block;padding:10px 12px;border-radius:10px;color:var(--txt);text-decoration:none}
        .nav a:hover{background:#111827}
        .container{max-width:1120px;margin:0 auto;padding:20px}
        .head{display:flex;align-items:center;justify-content:space-between}
        .avatar{width:44px;height:44px;border-radius:12px;background:#2563eb}
        .badge{padding:2px 8px;border-radius:999px;background:#064e3b}
        .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:16px 0}
        .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:14px}
        .card h3{margin:0 0 8px;color:var(--muted);font-size:13px}
        .card .val{font-size:22px;font-weight:700}
        .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
        .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
        .btn{display:inline-block;padding:10px 14px;border-radius:10px;background:var(--btn);color:#fff;text-decoration:none}
        table{width:100%;border-collapse:collapse}
        th,td{border-bottom:1px solid var(--line);padding:10px;text-align:left}
        th{color:var(--muted)}
        img.thumb{width:44px;height:44px;border-radius:10px;object-fit:cover}
        .status{padding:2px 8px;border-radius:999px;background:#1e293b}
    </style>
</head>
<body>
<div class="wrap" th:with="items=${page != null ? page.content : products}">


    <aside th:replace="~{Included/ShopSidebar :: shopSidebar( (${active} ?: '/shop/dashboard') )}"></aside>

    <main>
        <div class="container">
            <div class="head">
                <div style="display:flex;gap:12px;align-items:center">
                    <div class="avatar"></div>
                    <div>
                        <div style="font-weight:700" th:text="${shop != null ? shop.shopName : 'Dashboard'}">Shop name</div>
                        <span class="badge" th:text="${shop != null ? shop.status : 'UNKNOWN'}">ACTIVE</span>
                    </div>
                </div>
                <a class="btn" th:href="@{/shop/addProduct}">+ Add Product</a>
            </div>

            <!-- KPIs -->
            <div class="cards">
                <div class="card">
                    <h3>Total Products</h3>
                    <div class="val" th:text="${items != null ? #lists.size(items) : 0}">0</div>
                </div>
                <div class="card">
                    <h3>In Stock</h3>
                    <div class="val"
                         th:text="${items != null ? items.?[availableStock!=null and availableStock>0].size() : 0}">0</div>
                </div>
                <div class="card">
                    <h3>Low Stock (≤5)</h3>
                    <div class="val"
                         th:text="${items != null ? items.?[availableStock!=null and availableStock<=5 and availableStock>0].size() : 0}">0</div>
                </div>
                <div class="card">
                    <h3>Out of Stock</h3>
                    <div class="val"
                         th:text="${items != null ? items.?[availableStock!=null and availableStock==0].size() : 0}">0</div>
                </div>
            </div>

            <div class="grid">
                <section class="panel">
                    <h2 style="margin:0 0 10px">Products</h2>
                    <table>
                        <thead>
                        <tr>
                            <th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Status</th><th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="p : ${items}">
                            <td>
                                <img class="thumb"
                                     th:src="${p.img != null && !#strings.isEmpty(p.img)} ?
                                             @{/assets/img/{f}(f=${p.img})} :
                                             @{/assets/img/products/default.jpg}"
                                     alt="thumb">
                            </td>
                            <td th:text="${p.productName}">Name</td>
                            <td th:text="${p.category != null ? p.category.categoryName : '-'}">Cat</td>
                            <td th:text="${p.price != null ? #numbers.formatDecimal(p.price,1,'COMMA',2,'POINT') : '0'}">0</td>
                            <td th:text="${p.availableStock}">0</td>
                            <td><span class="status" th:text="${p.status}">ACTIVE</span></td>
                            <td>
                                <a th:href="@{/product/{id}(id=${p.id})}">View</a> |
                                <a th:href="@{/shop/updateProduct/{id}(id=${p.id})}">Update</a>
                            </td>
                        </tr>
                        <tr th:if="${items == null or #lists.isEmpty(items)}">
                            <td colspan="7" style="color:#9ca3af">Chưa có sản phẩm nào</td>
                        </tr>
                        </tbody>
                    </table>

                    <div style="margin-top:12px" th:if="${page != null}">
                        <a th:if="${page.hasPrevious()}" th:href="@{|/shop/dashboard?page=${page.number-1}|}">&laquo; Prev</a>
                        <span th:text="${page.number+1}">1</span>/<span th:text="${page.totalPages}">1</span>
                        <a th:if="${page.hasNext()}" th:href="@{|/shop/dashboard?page=${page.number+1}|}">Next &raquo;</a>
                    </div>
                </section>

                <aside class="panel">
                    <h2 style="margin:0 0 10px">Shop Info</h2>
                    <div><b>Shop Code:</b> <span th:text="${shop != null ? shop.shopCode : '-'}">SC001</span></div>
                    <div><b>Category:</b> <span th:text="${shop != null ? shop.category : '-'}">Electronics</span></div>
                    <div><b>Phone:</b> <span th:text="${shop != null ? shop.phone : '-'}">0123</span></div>
                    <div><b>Email:</b> <span th:text="${shop != null ? shop.email : '-'}">mail@shop.com</span></div>
                </aside>
            </div>
        </div>
    </main>
</div>
</body>
</html>
