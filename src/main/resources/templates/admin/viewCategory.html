<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi" th:inline="javascript">
<head>
    <meta charset="UTF-8">
    <title>ITP Admin | Category Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background:#0f172a; overflow-x:hidden; }
        .sidebar-wrapper { position:sticky; top:0; height:100vh; overflow-y:auto; background:#0f172a; border-right:1px solid #1f2937; padding:0; }
        .main-content { min-height:100vh; background:#fff; padding:1.25rem 1.25rem 2rem; }
        .page-title { font-weight:700; font-size:1.25rem; }
        .toolbar .form-select, .toolbar .form-control { background:#fff; }
        .badge-status { font-weight:600; }
        .badge-status.active { background:#22c55e; }
        .badge-status.inactive { background:#9ca3af; color:#111827; }
        .table td { vertical-align: middle; }
        .text-truncate-1 { max-width: 520px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pagination .page-link { border-radius: 8px; }
        .btn-icon { display:flex; align-items:center; gap:.35rem; }
    </style>
</head>

<body>
<!-- Header -->
<div th:replace="~{/Included/Header :: header}"></div>

<div class="container-fluid">
    <div class="row g-0">
        <!-- Sidebar -->
        <div class="col-lg-2 sidebar-wrapper">
            <div th:replace="~{/Included/AdminSidebar :: adminSidebar (currentPath=${#httpServletRequest.requestURI})}"></div>
        </div>

        <!-- Main -->
        <div class="col-lg-10 main-content">

            <!-- Top bar -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="page-title mb-0">Category Management</h3>
                <a th:href="@{/admin/categories/create}" class="btn btn-success btn-icon">
                    <span>ï¼‹</span> <span>Add New Category</span>
                </a>
            </div>

            <!-- Alerts -->
            <div th:if="${success}" class="alert alert-success py-2" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger py-2" th:text="${error}"></div>

            <!-- Filter/Search -->
            <form class="toolbar row g-2 align-items-center mb-3" th:action="@{/admin/categories}" method="get">
                <div class="col-md-5">
                    <div class="input-group">
                        <span class="input-group-text">ðŸ”Ž</span>
                        <input type="text" class="form-control" name="q" placeholder="Search by category name..."
                               th:value="${q}">
                    </div>
                </div>

                <div class="col-md-3">
                    <select class="form-select" name="status">
                        <option value="ALL" th:selected="${status} == null or ${status} == 'ALL'">All Status</option>
                        <option value="ACTIVE" th:selected="${status} == 'ACTIVE'">Active</option>
                        <option value="INACTIVE" th:selected="${status} == 'INACTIVE'">Inactive</option>
                    </select>
                </div>

                <div class="col-md-2 d-grid">
                    <button class="btn btn-outline-primary">Filter</button>
                </div>
                <div class="col-md-2 d-grid">
                    <a class="btn btn-outline-secondary" th:href="@{/admin/categories}">Reset</a>
                </div>
            </form>

            <!-- Table -->
            <div class="card shadow-sm border-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th style="width:80px;">ID</th>
                            <th style="width:220px;">Category Name</th>
                            <th>Description</th>
                            <th style="width:120px;">Status</th>
                            <th style="width:180px;">Created At</th>
                            <th style="width:120px;">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="c : ${pageData.content}">
                            <td th:text="${#numbers.formatInteger(c.id, 3)}">001</td>

                            <td>
                                <span class="fw-semibold" th:text="${c.categoryName}">Electronics</span>
                            </td>

                            <td>
                <span class="text-muted text-truncate-1"
                      th:text="${c.description}">Descriptionâ€¦</span>
                            </td>

                            <td>
                <span class="badge badge-status"
                      th:classappend="${c.status} == 'ACTIVE' ? ' active' : ' inactive'"
                      th:text="${c.status}">Active</span>
                            </td>

                            <td th:text="${#temporals.format(c.createAt, 'yyyy-MM-dd')}">2024-01-15</td>

                            <td>
                                <div class="d-flex gap-2">
                                    <a th:href="@{|/admin/categories/${c.id}/edit|}" class="btn btn-sm btn-outline-primary">Edit</a>

                                    <!-- Náº¿u báº¡n dÃ¹ng soft-delete: chuyá»ƒn Delete -> Disable / Enable -->
                                    <form th:action="@{|/admin/categories/${c.id}/delete|}" method="post"
                                          onsubmit="return confirm('Delete category #' + [[${c.id}]] + ' ?');">
                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>

                        <tr th:if="${pageData.empty}">
                            <td colspan="6" class="text-center text-muted py-4">No categories</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Footer + Pagination -->
                <div class="card-footer d-flex flex-wrap justify-content-between align-items-center gap-2">
                    <div>
                        Page <span th:text="${pageData.number + 1}">1</span> /
                        <span th:text="${pageData.totalPages}">1</span>
                        â€” Total <span th:text="${pageData.totalElements}">0</span> items
                    </div>

                    <nav th:if="${pageData.totalPages > 1}">
                        <ul class="pagination mb-0">
                            <!-- Previous -->
                            <li class="page-item" th:classappend="${pageData.first} ? ' disabled'">
                                <a class="page-link"
                                   th:href="@{/admin/categories(page=${pageData.number - 1}, q=${q}, status=${status})}">Previous</a>
                            </li>

                            <!-- Pages (hiá»ƒn thá»‹ Â±2 trang xung quanh trang hiá»‡n táº¡i) -->
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, pageData.totalPages - 1)}"
                                th:if="${i >= pageData.number - 2} and ${i <= pageData.number + 2}">
                                <a class="page-link"
                                   th:classappend="${i} == ${pageData.number} ? ' active' : ''"
                                   th:text="${i + 1}"
                                   th:href="@{/admin/categories(page=${i}, q=${q}, status=${status})}">1</a>
                            </li>

                            <!-- Next -->
                            <li class="page-item" th:classappend="${pageData.last} ? ' disabled'">
                                <a class="page-link"
                                   th:href="@{/admin/categories(page=${pageData.number + 1}, q=${q}, status=${status})}">Next</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
