<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Bootstrap CSS for dropdown -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Dropdown show class */
        #shopOrdersDropdown.show {
            display: block !important;
        }
        /* Click outside to close dropdown */
        body {
            position: relative;
        }
    </style>
</head>
<body>
<header th:fragment="header" style="
  background:#0f172a;color:#e2e8f0;position:sticky;top:0;z-index:1000;
  border-bottom:1px solid #1f2937;padding:.75rem 1.5rem;
  display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:1rem;width:100%;">

    <!-- Brand (trái) -->
    <a th:href="@{/}" class="brand" style="
     justify-self:start;font-weight:700;font-size:1.2rem;
     color:#22c55e;text-decoration:none;white-space:nowrap;">
        Item Trading Platform
    </a>

    <!-- Nav (giữa — luôn chính giữa viewport) -->
    <nav class="nav" style="justify-self:center;display:flex;gap:1.25rem;">
        <a th:href="@{/}" style="color:#cbd5e1;text-decoration:none;font-weight:500;">Trang chủ</a>
        <a th:href="@{/products}" style="color:#cbd5e1;text-decoration:none;font-weight:500;">Sản phẩm</a>
        <a th:href="@{/services}" style="color:#cbd5e1;text-decoration:none;font-weight:500;">Dịch vụ</a>
        <a th:href="@{/support}" style="color:#cbd5e1;text-decoration:none;font-weight:500;">Hỗ trợ</a>
    </nav>

    <!-- Auth (phải) -->
    <!-- Chưa đăng nhập -->
    <div th:if="${session.user == null}" style="justify-self:end;display:flex;gap:.5rem;white-space:nowrap;">
        <a th:href="@{/login}" style="color:#0f172a;background:#22c55e;border-radius:.4rem;
       padding:.4rem .8rem;text-decoration:none;font-weight:600;">Đăng nhập</a>
        <a th:href="@{/register}" style="color:#cbd5e1;border:1px solid #334155;border-radius:.4rem;
       padding:.35rem .75rem;text-decoration:none;">Đăng ký</a>
    </div>

    <!-- Đã đăng nhập -->
    <div th:if="${session.user != null}" style="justify-self:end;display:flex;flex-direction:column;align-items:flex-end;gap:.5rem;white-space:nowrap;">
        <div style="display:flex;align-items:center;gap:.75rem;">
            <div style="position:relative;z-index:1001;">
                <span style="color:#cbd5e1;cursor:pointer;" 
                      onclick="var d=document.getElementById('shopOrdersDropdown');if(d){d.style.display=d.style.display==='none'?'block':'none';}">
                  Xin chào,
                  <strong th:text="${session.user.fullName != null ? session.user.fullName : session.user.username}">User</strong>
                  <i class="fas fa-chevron-down" style="font-size:.7rem;margin-left:4px;"></i>
                </span>
                
                <!-- Dropdown cho tất cả user -->
                <div id="shopOrdersDropdown" 
                     style="display:none;position:absolute;top:100%;right:0;margin-top:.5rem;
                            background:#1f2937;border:1px solid #334155;border-radius:.4rem;
                            min-width:200px;box-shadow:0 4px 6px rgba(0,0,0,.3);z-index:1001;">
                    <!-- Menu cho tất cả user -->
                    <a th:href="@{/orders/history}" 
                       style="display:block;padding:.75rem 1rem;color:#cbd5e1;text-decoration:none;
                              border-bottom:1px solid #334155;transition:background .2s;"
                       onmouseover="this.style.background='#334155'" 
                       onmouseout="this.style.background='transparent'">
                        <i class="fas fa-shopping-bag" style="margin-right:8px;"></i>Lịch sử đơn hàng
                    </a>
                    
                    <!-- Menu chỉ cho SELLER -->
                    <a th:if="${session.role == 'SELLER'}" 
                       th:href="@{/shop/dashboard}" 
                       style="display:block;padding:.75rem 1rem;color:#cbd5e1;text-decoration:none;
                              border-bottom:1px solid #334155;transition:background .2s;"
                       onmouseover="this.style.background='#334155'" 
                       onmouseout="this.style.background='transparent'">
                        <i class="fas fa-tachometer-alt" style="margin-right:8px;"></i>Dashboard
                    </a>
                    <a th:if="${session.role == 'SELLER'}" 
                       th:href="@{/shop/orders}" 
                       style="display:block;padding:.75rem 1rem;color:#cbd5e1;text-decoration:none;
                              border-bottom:1px solid #334155;transition:background .2s;"
                       onmouseover="this.style.background='#334155'" 
                       onmouseout="this.style.background='transparent'">
                        <i class="fas fa-shopping-cart" style="margin-right:8px;"></i>Lịch sử bán hàng
                    </a>
                    <a th:if="${session.role == 'SELLER'}" 
                       th:href="@{/shop/inventory}" 
                       style="display:block;padding:.75rem 1rem;color:#cbd5e1;text-decoration:none;
                              transition:background .2s;"
                       onmouseover="this.style.background='#334155'" 
                       onmouseout="this.style.background='transparent'">
                        <i class="fas fa-warehouse" style="margin-right:8px;"></i>Kho hàng
                    </a>
                </div>
            </div>
            
            <a th:href="@{/logout}" style="color:#cbd5e1;border:1px solid #334155;border-radius:.4rem;
           padding:.35rem .75rem;text-decoration:none;">Đăng xuất</a>
        </div>
    </div>

</header>
<script th:inline="javascript">
    /*<![CDATA[*/
    // Close dropdown when clicking outside
    (function() {
        function initDropdown() {
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('shopOrdersDropdown');
                if (!dropdown) return;
                
                const greetingSpan = event.target.closest('span[onclick*="shopOrdersDropdown"]');
                const dropdownContainer = event.target.closest('div[style*="position:relative"]');
                
                if (!dropdown.contains(event.target) && !greetingSpan && !dropdownContainer) {
                    dropdown.style.display = 'none';
                }
            });
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initDropdown);
        } else {
            initDropdown();
        }
    })();
    /*]]>*/
</script>
</body>
</html>
